import json
import random

"""
简化版数据生成脚本：
- 不再依赖 ModelScope / MsDataset，避免各种版本冲突
- 直接构造一个小型中文金融问答数据集，用于 LoRA 微调演示
- 每次运行都会随机生成 100 条不完全相同的问答
"""

# 若想每次运行都可复现，可以固定随机种子，例如：
# random.seed(42)

# 一些基础金融知识模板（作为语义核心）
finance_qa_templates = [
    {
        "core_q": "什么是基金定投？",
        "core_a": "基金定投是指在固定时间以固定金额投资同一只或一篮子基金，通过分散投资时间来平滑成本、降低择时风险，适合长期理财目标。"
    },
    {
        "core_q": "银行理财产品会不会亏本？",
        "core_a": "银行理财并不一定保本，需要区分保本型和非保本型产品，还要关注产品的风险等级和投资标的，才能判断是否可能出现本金损失。"
    },
    {
        "core_q": "股票的市盈率一般如何解读？",
        "core_a": "市盈率是股价除以每股收益的比值，通常用于衡量估值水平，同一行业内对比更有意义，市盈率过高或过低都要结合成长性和风险一起分析。"
    },
    {
        "core_q": "普通投资者该如何理解债券到期收益率？",
        "core_a": "到期收益率大致反映了投资者买入并持有债券到期后，综合考虑票息收入、买入价格与面值差额等因素的年化收益水平。"
    },
    {
        "core_q": "货币基金和活期存款相比有什么特点？",
        "core_a": "货币基金主要投资于短期货币市场工具，风险较低、流动性较好，历史收益通常高于活期存款，但仍存在一定波动和流动性风险。"
    },
    {
        "core_q": "新手做基金定投要注意哪些风险？",
        "core_a": "需要注意市场整体估值水平、基金长期业绩稳定性以及自身的持有期限和心理预期，避免在短期波动时频繁暂停或赎回而放大亏损。"
    },
    {
        "core_q": "资产配置为什么比单纯选股更重要？",
        "core_a": "长期来看，大类资产之间的配置比例往往比单只股票或基金的选择更影响整体波动和收益，是管理组合风险的关键工具。"
    },
    {
        "core_q": "个人投资组合里债券类资产有什么作用？",
        "core_a": "债券和债券基金一般波动较小，可以在市场下跌时对冲部分股票资产的回撤，从而平滑整体投资组合的净值曲线。"
    },
    {
        "core_q": "什么是复利效应？",
        "core_a": "复利是“利滚利”的过程，只要长期保持正收益并尽量不频繁取出本金，时间越长，复利累积的效果就越明显。"
    },
    {
        "core_q": "如果只买一两只基金，有哪些常见误区？",
        "core_a": "常见误区包括过度依赖短期业绩排行榜、集中于单一行业主题、忽视基金经理更迭以及未考虑自身风险承受能力等。"
    },
]

# 场景、金额、期限等可变要素，用于生成不同表述
investor_profiles = [
    "刚参加工作两年的上班族",
    "即将退休的老师",
    "有房贷的中年工薪族",
    "自由职业的程序员",
    "刚开始理财的大学毕业生",
    "有一定投资经验的公务员",
    "风险偏好较高的年轻投资者",
    "偏好稳健理财的家庭主妇",
    "准备子女教育金的家长",
    "计划提前退休的打工人",
]

amount_ranges = [
    "每月定投 500 元",
    "每月定投 1000 元",
    "一次性投入 2 万元",
    "一次性投入 5 万元",
    "计划逐步投入 10 万元",
    "手里现在只有 3000 元闲钱",
    "准备拿出工资的 20% 做理财",
    "有一笔 5 万元的年终奖",
    "打算从基金开始小额尝试",
    "想先用小资金测试一下策略",
]

invest_horizons = [
    "投资期限大概 3–5 年",
    "希望 1–2 年内看到效果",
    "更关注 5 年以上的长期收益",
    "对资金流动性有一定要求",
    "可以接受中短期的净值波动",
    "希望整体比较稳健，不追求暴利",
]

extra_tips = [
    "在操作层面，应尽量分散投资时间和标的，避免把所有资金压在单一产品上。",
    "同时要养成定期回顾组合和调整仓位的习惯，根据市场环境和自身情况动态优化。",
    "建议先从简单的公募基金和银行理财开始，逐步熟悉各类资产的风险收益特征。",
    "务必仔细阅读产品说明书和风险揭示书，避免只看历史收益不看风险提示。",
    "如果对专业术语理解不深，可以多阅读基金公司和银行发布的投资者教育材料。",
    "遇到不懂的地方，可以先用小金额试水，再根据体验逐步加大投入。",
]


def main():
    total_samples = 100
    qwen_data = []

    for i in range(total_samples):
        template = random.choice(finance_qa_templates)
        profile = random.choice(investor_profiles)
        amount = random.choice(amount_ranges)
        horizon = random.choice(invest_horizons)
        tip = random.choice(extra_tips)

        # 生成更贴近真实咨询场景的问题
        user_question = (
            f"我是一名{profile}，{amount}，{horizon}。"
            f"在这种情况下，我想咨询：{template['core_q']}"
        )

        assistant_answer = (
            f"{template['core_a']}。结合你是{profile}、{amount}、{horizon}的情况，"
            f"需要特别注意控制整体仓位和流动性安排。{tip}"
        )

        qwen_data.append(
            {
                "messages": [
                    {"role": "user", "content": user_question},
                    {"role": "assistant", "content": assistant_answer},
                ]
            }
        )

    # 保存到 JSON 文件
    out_path = "finance_qa_mini.json"
    with open(out_path, "w", encoding="utf-8") as f:
        json.dump(qwen_data, f, ensure_ascii=False, indent=2)

    print(f"✅ 已成功保存 {len(qwen_data)} 条随机生成的数据到 {out_path}")


if __name__ == "__main__":
    main()
